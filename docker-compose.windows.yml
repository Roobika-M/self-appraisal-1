version: '3.9'

# Combined Windows compose file supporting both production frontend (nginx)
# and a dev frontend (Vite) which runs under the `dev` profile. Both
# services are configured to talk to a backend running on the Windows host
# at http://host.docker.internal:5000 (use run-backend-windows.ps1 to run it).

services:
  # Production-like frontend (built & served by nginx)
  frontend:
    build:
      context: .
      dockerfile: Frontend.Dockerfile
    ports:
      - '8080:80'
    environment:
      - VITE_API_URL=http://host.docker.internal:5000
    networks:
      - appnet

  # Development frontend with Vite (HMR). Enabled when using the `dev` profile:
  # docker compose -f docker-compose.windows.yml --profile dev up
  frontend_dev:
    image: node:18
    working_dir: /app
    ports:
      - '5173:5173'
    volumes:
      - ./:/app
      - /app/node_modules
    environment:
      - VITE_API_URL=http://host.docker.internal:5000
    command: sh -c "npm ci && npm run dev -- --host 0.0.0.0 --port 5173"
    profiles:
      - dev
    networks:
      - appnet

networks:
  appnet:
    driver: bridge
